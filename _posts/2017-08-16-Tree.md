---
layout: post
title: 알고리즘스터디] Tree
---

## 1. 균형 검색 트리(Balanced Search Tree)
균형 검색 트리는 검색 트리의 한 종류로 스스로 균형을 유지하는 검색트리를 말한다.
대표적으로 B트리가 있다.
균형검색트리는 많은 자료를 추가, 삭제하는 환경에서도 빠른 검색 성능을 제공한다.(Ex. 데이터베이스)
균형검색트리가 안정적인 속도를 낼 수 있는 이유는 '균형'을 유지하면서 자료를 저장하기 때문이다.
균형검색트리는 트리 자체의 알고리즘으로 자료가 추가, 삭제될때 트리 자체의 알고리즘으로 균형을 유지한다.




## 2.이진 검색 트리(Binary Search Tree)
이진 검색 트리의 경우 균형검색트리는 아니다.
하지만 균형검색트리에 대해 설명하기전에 가장 간단한 이진검색트리를 통해 트리에 대한 개념을 알아본다.
이진 검색트리는 자식 노드가 2개 이하인 검색트리를 말한다.
또한 왼쪽 서브트리의 모든 값이 현재 노드의 키 값보다 작다.
또한 오른쪽 서브트리의 모든 값이 현재 노드의 키값보다 크다.
이러한 특성을 통해 이진검색트리의 모든 노드는 유일한 키 값을 가지고, 효율적인 검색을 가능하게한다.

Ex)       |20|
       ／      ＼
    |10|        |24|
  ／    ＼     ／
|6|     |14| |22|

루트 노드는 20이고 왼쪽서브트리의 노드들인 10, 6, 14는 모두 20보다 작다.
또한 20의 오른쪽 서브트리의 노드들인 24, 22는 모두 20보다 크다.
다른 서브트리를 가지는 노드들인 10, 24도 같은 성질을 가진다.

이러한 특성이 검색 성능에 영향을 주는 이유는 각 노드와 입력값을 비교만 해도 찾을 대상이 반씩 줄어들기 때문이다.(바이너리서치와 같은 원리)
다만 이진검색트리의경우 추가, 삭제시 균형을 유지하는 알고리즘이 없기때문에 스스로 균형을 잃을 수 있다.
균형을 잃을 경우 비교를 통해 찾을 대상이 적게 줄어들 수 있어 검색성능이 줄어든다.

Ex)
(a) 균형 이진 검색 트리
자료 추가 순서: 30 -> 20 -> 40 -> 10 -> 24 -> 34 -> 46
|30| ->      |30|    ->     |30|
           ／             ／    ＼
         |20|           |20|    |40|


->        |30|         ->          |30|
        ／    ＼                 ／    ＼
      |20|    |40|             |20|    |40|
    ／                       ／   ＼
  |10|                     |10|   |24|

->            |30|         ->          |30|
            ／    ＼                 ／    ＼
        |20|       |40|           |20|      |40|
      ／   ＼     ／             ／  ＼    ／  ＼
    |10|   |24| |34|           |10|  |24| |34| |46|

(b) 불균형 이진 검색 트리
자료 추가 순서: 10 -> 20 -> 24 -> 30 -> 34 -> 40 -> 46
|10| -> |10|     -> |10|       ->|10|          -> |10|            -> |10|             -> |10|
            ＼          ＼          ＼               ＼                ＼                  ＼
            |20|        |20|         |20|            |20|              |20|                |20|
                           ＼           ＼              ＼               ＼                   ＼
                           |24|         |24|            |24|             |24|                  |24|
                                           ＼              ＼               ＼                    ＼
                                           |30|            |30|             |30|                  |30|
                                                             ＼                ＼                    ＼
                                                             |34|              |34|                  |34|
                                                                                 ＼                     ＼
                                                                                 |40|                   |40|
                                                                                                           ＼
                                                                                                           |46|


최대 비교 횟수를 비교해보면 (a)는 3회, (b)는 7회이다.
평균 비교 횟수는
(a)의 경우 1, 2, 2, 3, 3, 3, 3으로 2.43번이다.
(b)의 경우 1, 2, 3, 4, 5, 6, 7으로 4번이다.

균형 검색 트리의 경우 반씩 줄어드므로 빅-오 표기법으로 성능을 표기할 경우 O(logn)이다.
하지만 불균형 검색 트리의 경우 O(n)이다.
불균형 검색 트리의 경우 최악의 경우 선형적 구조를 가지게 되며 리스트와 똑같이 모든 노드와 비교를 해야하기 때문이다.




## 3. 균형 이진 검색 트리(Balanced Binary Search Tree)
균형 이진 검색 트리가 불균형 이진 검색 트리에 비해 성능이 좋다는건 위의 예시로 봤다.
균형 검색트리에는 AVL 트리, 레드-블랙 트리등이 있다.
균형 이진 검색트리의 경우 불균형 이진 검색 트리에 비해 성능이 월등히 좋다.
그러나 이진 트리라는 한계가 있어 저장하는 자료의 개수가 증가함에 따라 트리의 높이가 높아지는 문제가있다.
물론 10,000,000개의 자료를 저장하더라도 트리의 높이가 24기때문에 최대 24번만 비교하면 되어 기본적으로는 문제가 없다.
하지만 트리 노드가 디스크에 저장된 경우에는 성능에 문제가 생긴다.
Ex)
데이터 베이스에서는 저장하는 자료 1개의 크기가 크기때문에 보통 노드 단위로 디스크에 저장한다.
그리고 비교 연산이 필요한 경우에 해당 노드를 디스크에서 읽어들여 메모리로 적재한다.
즉 노드별 비교 연산을 위해 디스크를 읽는 작업이 동반되며 트리의 높이가 높아질수록 디스크에서 자료를 읽는 횟수가증가한다.
이는 상당한 성능 저하의 원인이 될 수 있다.




## 4.다원 검색 트리(Multiway Search Tree)
다원 검색트리는 m-원 검색 트리(m-way search tree)라고도 한다.
여기서는 다원 검색 트리라고 하겠다.
다원 검색트리는 한 노드안에 여러개의 자료를 가질 수 있으며 자식 노드 또한 여러 개 가질 수 있다.

Ex)
        |4|8|12|
      ／ ｜ ｜  ＼
   |||  ||| |||  |||


### 4.1 다원 검색 트리의 특성
-각 노드는 0에서 최대 m개의 서브트리를 가진다.
-k개의 자식 노드를 가지는 노드는 (k-1)개의 자료를 가진다.(k <= m)
-각 노드안에 있는 자료는 검색 키로 정렬된다. (Ex 4 -> 8 -> 12, 1 -> 3 -> 8...)
-다음 조건을 항상 만족한다.
 key i <= i번째 서브트리내의 모든 키값 < key(i+1)
-모든 서브트리는 m-원 검색 트리다.




## 5.B 트리 (B Tree)
B 트리는 다원 검색 트리의 종류중 하나로 자료를 추가, 삭제할 때 스스로 균형을 유지하는 균형 다원 검색 트리이다.


### 5.1 B 트리의 특성
-루트 노드는 단말(leaf)노드거나 2~m개의 서브트리를 가진다.
-루트 노드를 제외한 모든 내부 노드는 아래의 개수만큼 서브트리를 가진다.
 m/2(올림) <= 서브트리개수 <= m
-단말 노드는 아래의 개수만큼 자료를 가진다.
 m/2(올림) -1 <= 자료개수 <= m - 1
-모든 단말 노드는 같은 레벨에 있다. 즉, 트리는 완전한 균형상태에 있다.

Ex)
|4|8|12|16| 루트노드만 존재하는 B 트리가 있다고 할 때 20이라는 새로운 값이 추가된경우.(m = 5)
특성1에 따라서 자식노드가 2개가 추가되어야 한다.
또한 특성3에 따라서 자식 노드가 2 <= 자료개수 <= 4개여야한다.
즉 자식노드는 최소 2개의 자료를 가져야한다.
따라서 아래와 같은 상태가 된다.
     | 12 ||||
    ／     ＼
|4|8|||    |16|20|||

m에 따른 서브트리와 자료의 개수
       서브트리의개수  |    자료의개수   |
  m  |  최소  |  최대  |  최소  |  최대  |
  3  |    2   |   3    |    1   |    2   |
  4  |    2   |   4    |    1   |    3   |
  5  |    3   |   5    |    2   |    4   |
  m  |  ┌m/2┐ |   m    |┌m/2┐-1 |  m - 1 |




### 5.2 B 트리의 연산

### 5.2.1 자료 추가
가장 먼저 B 트리에서 자료를 추가하는 연산을 알아보겠다.
추가 연산은 저장할 위치를 찾는 단계, 실제 자료를 저장하는 단계, 균형유지 단계와 같은 3단계로 이루어진다.

#### 5.2.1.1 위치 찾기(검색)
새로운 자료를 B 트리에 추가하기 위해서는 먼저 새로운 자료를 추가하기 적합한 곳을 찾아야 한다.
검색 방법은 이진트리와 비슷하다.

일단 루트 노드에서 시작한다.
1. 추가하려는 자료의 값과 현재 노드에 저장된 자료의 값을 비교한다.
2. 추가하려는 자료의 값이 현재 비교 대상의 값보다 작다면 현재 자료의 서브트리로 이동한다.
3. 추가하려는 자료의 값이 현재 비교 대상의 값보다 크다면 현재 자료의 오른쪽 칸으로 간다.
4. 1 ~ 3과정을 반복한다.
5. 현재 노드의 모든 자료보다 더 크다면 현재 노드의 가장 오른쪽 서브트리로 이동한다.
6. 1 ~ 5과정을 반복한다.
이 과정에서 계속 서브트리로 가는 과정만 존재하기때문에 값은 항상 leaf노드에 저장이 된다.

#### 5.2.1.2 자료 저장
자료를 저장하는 단계에서 저장하려는 노드에 공간이 존재한다면 그냥 저장하면 된다.
그러나 B트리는 저장할 수 있는 자료의 수가 최대 m-1개다.
따라서 공간이 모자를 수 있다.
이럴경우 3단계인 균형유지단계로 넘어가게된다.

#### 5.2.1.3 균형 유지
균형 유지단계에서는 노드의 분할이라는 방법을 사용한다.
노드 분할이란 1개의 노드를 여러개의 노드로 나누어서 새로운 데이터를 추가할 여유공간을 확보하는것을 의미한다.

Ex) m = 5일경우
|10|30|50|60|70| 이 됐을경우. (5개의 데이터중 1개는 이번에 추가될 데이터고 나머지 4개는 이미 노드에 존재했던 데이터)
m이 5이므로 한 노드에 최대 4개의 자료를 저장할 수 있다.
이 경우 중간값을 기준으로 기존 노드를 두개로 분할한다.
분할된 노드는 아래와 같다.
    |50|
   ／   ＼
|10|30| |60|70|
